<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<meta name="X-UA-Compatible" , content="IE=edge">

<title>webpæ˜¯è¯¥ç”¨èµ·æ¥äº† | RayLiao</title>

<meta name="description" content="æµ©ç€šå®‡å®™ï¼Œåªæ˜¯å°½åŠ›è®°å½•è‡ªå·±æ¶ˆè€—çš„æ—¶å…‰ï¼Œrayliao,åšå®¢,å‰ç«¯,äº’è”ç½‘,æŠ€æœ¯,ç”Ÿæ´»,å®¢å®¶,å¹¿å·,æ‘„å½±,ç”µå½±">

<meta name="viewport" , content="width=device-width, initial-scale=1">
<link rel="icon" type="image/svg" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âœğŸ»</text></svg>">
<link rel="stylesheet" href="/blog/css/apollo.css">
  </head>

  <body>
    <div class="wrap">
      <header>
        <a href="/blog/" class="logo-link">
          RayLiao
          <span data-letters="RayLiao"></span>
          <span data-letters="RayLiao"></span>
        </a>
        <ul class="nav nav-list">
    
    
    <li class="nav-list-item">
        <a href="/blog/archives" class="nav-list-link " target="_self">
            ARCHIVES
        </a>
    </li>
    
    
    <li class="nav-list-item">
        <a href="http://www.rayliao.com/" class="nav-list-link " target="_blank">
            RAY
        </a>
    </li>
    
    
    <li class="nav-list-item">
        <a href="https://github.com/rayliao" class="nav-list-link " target="_blank">
            GITHUB
        </a>
    </li>
    
    
    <li class="nav-list-item">
        <a href="http://weibo.com/574954033" class="nav-list-link " target="_blank">
            WEIBO
        </a>
    </li>
    
</ul>
      </header>
      <main class="container">
        <div class="post">
    <article class="post-block">
        <h1 class="post-title">
            webpæ˜¯è¯¥ç”¨èµ·æ¥äº†
        </h1>
        <div class="post-info">
    2020å¹´5æœˆ22æ—¥
    
    
    <a href="/blog/tags/æŠ€æœ¯/" class="post-tag">#æŠ€æœ¯</a>
    
    
</div>
        <div class="post-content">
            <p>webpçš„å¥½å¤„ä¸ç”¨å¤šè¯´äº†ï¼Œç›¸æ¯”jpgå’Œpngæ ¼å¼ï¼Œæ–‡ä»¶å¤§å°èƒ½èŠ‚çœå¾ˆå¤šã€‚ä½†å› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒï¼Œæ‰€ä»¥éœ€è¦åšä¸€äº›å…¼å®¹å¤„ç†ã€‚</p>
<h3 id="å¾—åˆ°webp"><a href="#å¾—åˆ°webp" class="headerlink" title="å¾—åˆ°webp"></a>å¾—åˆ°webp</h3><p>éšä¾¿æœç´¢å¼•æ“ä¸€æœï¼Œä¼šæœ‰å¾ˆå¤šåœ¨çº¿è½¬æ¢å›¾ç‰‡æ ¼å¼çš„å·¥å…·ï¼Œä¹Ÿæœ‰å¾ˆå¤šå¯ä¾›ä¸‹è½½çš„å·¥å…·ï¼Œçœ‹ä½ è‡ªå·±æ€ä¹ˆç”¨äº†ï¼Œæ¯”å¦‚è¯´å‰ç«¯çš„<code>gulp</code>ï¼Œä¼šæœ‰å¯¹åº”çš„å›¾ç‰‡å‹ç¼©è½¬æ¢çš„æ’ä»¶å¯ä½¿ç”¨ã€‚è¿™é‡Œæˆ‘å°±è¯´ä¸‹googleæä¾›çš„çš„å‘½ä»¤è¡Œå·¥å…·<code>webp</code>ã€‚</p>
<p>åœ¨Macä¸‹å¯ä»¥ä½¿ç”¨homebrewå®‰è£…webpå·¥å…·ï¼š</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install webp</span><br></pre></td></tr></table></figure>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨cwebpå°†jpgæˆ–pngè½¬æˆwebpæ ¼å¼ï¼š</p>
<figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cwebp [-preset &lt;...&gt;] [options] in_file [-o out_file]</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šçš„æ“ä½œè‡ªè¡ŒæŸ¥é˜…<a href="https://developers.google.com/speed/webp/docs/using" target="_blank" rel="noopener">æ–‡æ¡£</a>å§ã€‚</p>
<a id="more"></a>
<h3 id="åç«¯å¤„ç†"><a href="#åç«¯å¤„ç†" class="headerlink" title="åç«¯å¤„ç†"></a>åç«¯å¤„ç†</h3><p>è¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œå¤§æ¦‚åŸç†å°±æ˜¯åœ¨æµè§ˆå™¨å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œå¯¹äºæ”¯æŒwebpå›¾ç‰‡çš„æµè§ˆå™¨ï¼Œä¼šåœ¨è¯·æ±‚å¤´Acceptä¸­å¸¦ä¸Šimage/webpçš„ä¿¡æ¯ï¼ŒæœåŠ¡å™¨å°±èƒ½è¯†åˆ«æµè§ˆå™¨æ˜¯å¦æ”¯æŒwebpä»è€Œè¿”å›å¯¹åº”çš„å›¾ç‰‡æ ¼å¼ï¼Œå…·ä½“å¯æŸ¥çœ‹å‡¹å‡¸å®éªŒå®¤çš„æ–‡ç« â€”â€”<a href="https://aotu.io/notes/2016/06/23/explore-something-of-webp/" target="_blank" rel="noopener">æ¢ç©¶WebPä¸€äº›äº‹å„¿</a></p>
<h3 id="å‰ç«¯å¤„ç†"><a href="#å‰ç«¯å¤„ç†" class="headerlink" title="å‰ç«¯å¤„ç†"></a>å‰ç«¯å¤„ç†</h3><p>åœ¨é¡µé¢ä¸Šå¯ä»¥ä½¿ç”¨<code>picture</code>æ ‡ç­¾æ¥åšå…¼å®¹ï¼Œä¼šæ ¹æ®æµè§ˆå™¨è®¾å¤‡ç‰ˆæœ¬é€‰æ‹©ä¸åŒçš„é€‰é¡¹ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- JPEG --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">        <span class="attr">srcset</span>=<span class="string">"./images/example.jpg"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"image/jpeg"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- WebP --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">        <span class="attr">srcset</span>=<span class="string">"./images/example.webp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"image/webp"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- The fallback --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">"./images/example.jpg"</span> <span class="attr">alt</span>=<span class="string">"example"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½†è¿™æ ·å†™ä¼šæ¯”è¾ƒè‡ƒè‚¿ï¼Œå¯ä»¥é€šè¿‡<code>Service Wroker</code>æ¥æ‹¦æˆªç½‘ç»œè¯·æ±‚ï¼Œç›‘å¬fetchäº‹ä»¶ï¼Œæ ¹æ®Acceptå¤´éƒ¨æ¥åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒwebpå›¾ç‰‡ï¼Œå¹¶ä¸”æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨<code>image/webp</code>Mimeç±»å‹ï¼Œè¿™æ ·å°±å¯ä»¥ç¡®å®šå¹¶æ›¿æ¢æˆwebpè¿”å›ã€‚</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// serviceWorker.ts</span></span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'fetch'</span>, <span class="function">(<span class="params">e: <span class="built_in">any</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Clone the request</span></span><br><span class="line">    <span class="keyword">const</span> req = e.request.clone()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check if the image is a jpeg</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/\.jpg$|.png$/</span>.test(e.request.url)) &#123;</span><br><span class="line">    <span class="comment">// Get all of the headers</span></span><br><span class="line">    <span class="keyword">const</span> headers: <span class="built_in">string</span>[] = <span class="built_in">Array</span>.from(req.headers.entries())</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Inspect the accept header for WebP support</span></span><br><span class="line">    <span class="keyword">const</span> acceptHeader: <span class="built_in">string</span>[] = headers.filter(</span><br><span class="line">        (item) =&gt; item[<span class="number">0</span>] === <span class="string">'accept'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">const</span> supportsWebp = acceptHeader[<span class="number">1</span>].includes(<span class="string">'webp'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If we support WebP</span></span><br><span class="line">    <span class="keyword">if</span> (supportsWebp) &#123;</span><br><span class="line">        <span class="comment">// Build the return URL</span></span><br><span class="line">        <span class="keyword">const</span> returnUrl =</span><br><span class="line">        req.url.substr(<span class="number">0</span>, req.url.lastIndexOf(<span class="string">'.'</span>)) + <span class="string">'.webp'</span></span><br><span class="line"></span><br><span class="line">        e.respondWith(</span><br><span class="line">        fetch(returnUrl, &#123;</span><br><span class="line">            mode: <span class="string">'no-cors'</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ç„¶åé¡µé¢å°±å¯ä»¥å†™å¾—ç®€å•äº›ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span></span></span><br><span class="line"><span class="tag">        <span class="attr">srcset</span>=<span class="string">"./images/example.jpg"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"image/jpeg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½†çœ‹äº†ä¸‹è¿™ä¸ª<a href="https://deanhume.github.io/Service-Workers-WebP/" target="_blank" rel="noopener">ä¾‹å­</a>ï¼Œä¹Ÿä¸€æ ·ä¼šå»è¯·æ±‚jpgçš„å›¾ç‰‡ï¼Œé‚£è¿™æ ·å°±ä¸èµ·ä½œç”¨äº†ã€‚</p>
<h3 id="Reactä¸‹ä½¿ç”¨ä¸”è¦æ”¯æŒCSSå†…ä½¿ç”¨"><a href="#Reactä¸‹ä½¿ç”¨ä¸”è¦æ”¯æŒCSSå†…ä½¿ç”¨" class="headerlink" title="Reactä¸‹ä½¿ç”¨ä¸”è¦æ”¯æŒCSSå†…ä½¿ç”¨"></a>Reactä¸‹ä½¿ç”¨ä¸”è¦æ”¯æŒCSSå†…ä½¿ç”¨</h3><p>ä¸Šé¢çš„æ–¹å¼æ˜¯æŒºæ–¹ä¾¿çš„ï¼Œä½†å› ä¸ºæˆ‘çš„ä¸ªäººç½‘ç«™ç›®å‰ä½¿ç”¨reactï¼Œæœ‰äº›å›¾ç‰‡æ˜¯å¯¼å…¥è¿›å»ä½¿ç”¨çš„ï¼Œæˆ‘è¯•äº†ä¸‹å¦‚æ­¤service workerçš„æ–¹å¼å°±ä¸æ”¯æŒäº†ã€‚åŠ ä¹‹å¾ˆå¤šæ—¶å€™ä¼šåœ¨csså†…å¼•å…¥èƒŒæ™¯å›¾ç‰‡ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨service workeråšåˆ¤æ–­ï¼Œé‚£å°±è¿˜æ˜¯åœ¨é¡µé¢ä¸Šæ“ä½œï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ImgWithFallback = (&#123;</span><br><span class="line">  src,</span><br><span class="line">  fallback,</span><br><span class="line">  type = <span class="string">'image/webp'</span>,</span><br><span class="line">  ...delegated</span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;picture&gt;</span><br><span class="line">      &lt;source srcSet=&#123;src&#125; type=&#123;type&#125; /&gt;</span><br><span class="line">      &lt;img src=&#123;fallback&#125; &#123;...delegated&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/picture&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨çš„æ—¶å€™æ˜¯ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;ImgWithFallback</span><br><span class="line">  src=&#123;<span class="built_in">require</span>(<span class="string">"./images/example.webp"</span>)&#125;</span><br><span class="line">  fallback=&#123;<span class="built_in">require</span>(<span class="string">"./images/example.png"</span>)&#125;</span><br><span class="line">  alt=<span class="string">"example"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>æƒ³è¦åœ¨csså†…ä½¿ç”¨webpï¼Œå°±å¾—çŸ¥é“æµè§ˆå™¨æ˜¯å¦æ”¯æŒwebpï¼Œç„¶ååœ¨htmlåŠ ä¸Šä¸€ä¸ªclassåšæ ‡è¯†ï¼Œå¦‚æ­¤åœ¨csså†…ä½¿ç”¨backgroundå¼•å…¥å›¾ç‰‡çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ ¹æ®classå»å¼•å…¥ä¸åŒæ ¼å¼çš„å›¾ç‰‡ã€‚</p>
<p>å¦‚ä½•çŸ¥é“æµè§ˆå™¨æ˜¯å¦æ”¯æŒwebpå‘¢ï¼Œåˆ›å»ºä¸€ä¸ªcanvasåˆ¤æ–­ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">canUseWebP</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> elem = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">    <span class="keyword">if</span> (!!(elem.getContext &amp;&amp; elem.getContext(<span class="string">'2d'</span>))) &#123;</span><br><span class="line">        <span class="comment">// was able or not to get WebP representation</span></span><br><span class="line">        <span class="keyword">return</span> elem.toDataURL(<span class="string">'image/webp'</span>).indexOf(<span class="string">'data:image/webp'</span>) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// very old browser like IE 8, canvas not supported</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ ¹æ®åˆ¤æ–­åœ¨htmlæ ‡ç­¾åŠ ä¸Šclasså³å¯ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://aotu.io/notes/2015/11/06/webp-responsive-image/" target="_blank" rel="noopener">https://aotu.io/notes/2015/11/06/webp-responsive-image/</a></li>
<li><a href="https://aotu.io/notes/2016/06/23/explore-something-of-webp/" target="_blank" rel="noopener">https://aotu.io/notes/2016/06/23/explore-something-of-webp/</a></li>
<li><a href="https://www.npmjs.com/package/react-image-webp" target="_blank" rel="noopener">https://www.npmjs.com/package/react-image-webp</a></li>
<li><a href="https://joshwcomeau.com/performance/embracing-modern-image-formats/" target="_blank" rel="noopener">https://joshwcomeau.com/performance/embracing-modern-image-formats/</a></li>
<li><a href="https://developers.google.com/speed/webp/docs/using" target="_blank" rel="noopener">https://developers.google.com/speed/webp/docs/using</a></li>
<li><a href="https://css-tricks.com/using-webp-images/#article-header-id-3" target="_blank" rel="noopener">https://css-tricks.com/using-webp-images/#article-header-id-3</a></li>
</ul>

        </div>
    </article>
</div>
<div id="gitalk-container"></div>
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<!-- <script src="https://geektutu.github.io/hexo-theme-geektutu/js/gitalk.min.js"></script> -->
<!-- è‡¨æ™‚è§£æ±ºæ–¹æ¡ˆ -->
<script src="https://unpkg.com/gitalk/dist/gitalk.js"></script>
<script type="text/javascript">
  var gitalk = new Gitalk({
    accessToken: '00f4c7413df974956ac1ad555e33bcc24fa06e25',
    id: location.pathname.substr(6),
    repo: 'blog',
    owner: 'rayliao',
    admin: 'rayliao',
    distractionFreeMode: 'false',
  })
  gitalk.render('gitalk-container')
</script>

      </main>
      <footer>
        <div class="paginator">
    
    
    
    <a href="/blog/2020/06/bb608ee0/" class="prev">prev post</a>
    
    
    <a href="/blog/2020/05/57cb9257/" class="next">next post</a>
    
    

</div>
        <div class="copyright">
          
          <p>
            Â© 2016 - 2020 <a href="http://www.rayliao.com/blog">Ray Liao</a>,
            powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
            <a href="https://github.com/rayliao/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.
          </p>
        </div>
      </footer>
    </div>
  </body>
</html>
